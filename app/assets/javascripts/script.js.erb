
/* All ajax requests are sending authenticty token*/
$(document).ajaxSend(function(event, request, settings) {
  if (typeof(AUTH_TOKEN) == "undefined") return;
  // settings.data is a serialized string like "foo=bar&baz=boink" (or null)
  settings.data = settings.data || "";
  settings.data += (settings.data ? "&" : "") + "authenticity_token=" + encodeURIComponent(AUTH_TOKEN);
});

$(document).ready(function() {
  
  console.log("JOMG GGG");
  /*  For the Subject-teacher assignment 
    or
      For the Course-teacher assignment
  */
  $(".is_checked_class").change( function(){
    var $checkbox = $(this);
    var after_clicked_value;
    
    /*
      Extracting the value of the checkbox, based on the user action
    */
    if(   $checkbox.is(":checked")  ) {
      $checkbox.attr('value', <%= TRUE_CHECK %>);
    }else{
      $checkbox.attr( 'value', <%= FALSE_CHECK %> );
    }
    
  });
  
  
  $("a.close").live("click", function(){
    var $this = $(this);
    var $container = $(this).parents(".alert");
    $container.fadeOut();
    $container.remove();
    return false;
  });
  
  
  // $(".alert-message").alert()
  
  
  //  ajax post 
  $("#save_button").click(function(){
    var destination_url = $("#destination_url").attr("value");
    
    
    var selection_array = [];
    $(".is_checked_class").each(function(){
      var $input_checkbox = $(this);
      
      // console.log( "teacher id is " + teacher_id);
      var teacher_id = $input_checkbox.attr("id").split("_")[1];
      
      //  check the checked value.. if it is , send 1 to server, if it is not, send 0 to server
      
      var object = {};
      object["user"] =  teacher_id; // the id
      object["value"]  = $input_checkbox.attr("value"); 
      selection_array.push( object );
    });
    
    
    selection_array =  JSON.stringify(selection_array);
    console.log( selection_array );
    $.ajax({
      url : destination_url, 
      type : "POST",
      data : selection_array,
      dataType : 'script',
      success : function( response ) {
        // $whole_container.hideLoading();
      }
    });
    
    
 
    
    
  });
  
  console.log("Gonna call the masonry");
   
   $('#uploaded_image_container').masonry({
       itemSelector : '.item'
     });
  
  

  
  
});